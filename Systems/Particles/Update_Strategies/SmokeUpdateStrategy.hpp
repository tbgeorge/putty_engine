//=================================================================================
// SmokeUpdateStrategy.hpp
// Author: Tyler George
// Date  : June 18, 2015
//=================================================================================

#pragma once

#ifndef __included_SmokeUpdateStrategy__
#define __included_SmokeUpdateStrategy__

///---------------------------------------------------------------------------------
/// Includes
///---------------------------------------------------------------------------------
#include "Engine/Common/EngineCommon.hpp"
#include "Engine/Systems/Particles/ParticleEmitter.hpp"

///---------------------------------------------------------------------------------
/// Typedefs
///---------------------------------------------------------------------------------

///---------------------------------------------------------------------------------
///
///---------------------------------------------------------------------------------
class SmokeUpdateStrategy : public ParticleEmitter::UpdateStrategy
{
public:
    ///---------------------------------------------------------------------------------
    /// Constructors/Destructors
    ///---------------------------------------------------------------------------------
    SmokeUpdateStrategy( const float& mass, const float& defaultSpeed, const Vector3& normal, const float& maxRadius, const float& minVelScale, const float& maxVelScale, const bool& gravity );

    ///---------------------------------------------------------------------------------
    /// Initialization
    ///---------------------------------------------------------------------------------

    ///---------------------------------------------------------------------------------
    /// Accessors/Queries
    ///---------------------------------------------------------------------------------
    const Vector3 GetVelocity();

    StateVector3D CalculateDerivative( const StateVector3D& initialState );
    StateVector3D RK4( const StateVector3D& initialState, const double& deltaT );

    ///---------------------------------------------------------------------------------
    /// Mutators
    ///---------------------------------------------------------------------------------
    void SetWindForce( const float& c, const Vector3& wind );

    ///---------------------------------------------------------------------------------
    /// Update
    ///---------------------------------------------------------------------------------
    void Update( double deltaSeconds, Particle* first, Particle* firstInactive );

    ///---------------------------------------------------------------------------------
    /// Render
    ///---------------------------------------------------------------------------------

    ///---------------------------------------------------------------------------------
    /// Public Member Variables
    ///---------------------------------------------------------------------------------

    ///---------------------------------------------------------------------------------
    /// Static Variables
    ///---------------------------------------------------------------------------------


private:
    ///---------------------------------------------------------------------------------
    /// Private Functions
    ///---------------------------------------------------------------------------------

    ///---------------------------------------------------------------------------------
    /// Private Member Variables
    ///---------------------------------------------------------------------------------
    float m_defaultSpeed;
    Vector3 m_normal;
    float m_maxRadius;
    float m_minVelScale;
    float m_maxVelScale;

    float m_windC;
    Vector3 m_windForce;
    bool m_gravityEnabled;
};

///---------------------------------------------------------------------------------
/// Inline function implementations
///---------------------------------------------------------------------------------

#endif